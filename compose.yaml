services:
  # Det betyder her starter listen over de containere, der skal køre

  backend:
    # Navnet på servicen – man vælger selv navnet, her hedder den backend
    image: boernetoej-backend
    # Her siges der: brug Docker-imaget med navnet boernetoej-backend
    # Det er et image, vi tidligere har bygget med Dockerfile
    # Der buildes altså ikke her – der startes kun en container

    ports:
      - "127.0.0.1:8080:8080"
      # Her defineres port-mapping mellem host og container
      # format: host-port:container-port
      # Venstre 8080 er porten på host-maskinen (din computer)
      # Højre 8080 er porten inde i containeren
      # Backend kan derfor tilgås på http://localhost:8080

    environment:
      # Environment variables bruges til at konfigurere Spring Boot
      # uden at hardcode database-oplysninger i koden
      - SPRING_PROFILES_ACTIVE=mysql
      - URL=jdbc:mysql://mysql:3306/boernetoej
      - USER=boernetoej
      - PASSWORD=boernetoej
      - DB_DRIVER=com.mysql.cj.jdbc.Driver

    depends_on:
      # Sikrer at databasen starter før backend
      - mysql

  mysql:
    # Database-servicen
    image: mysql:latest
    # Bruger et færdigt MySQL-image fra DockerHub

    container_name: boernetoej-mysql
    # Giver containeren et fast navn

    restart: always
    # Sørger for at containeren genstarter, hvis den crasher

    environment:
      # MySQL konfigureres ved opstart
      MYSQL_ROOT_PASSWORD: boernetoej
      MYSQL_DATABASE: boernetoej
      MYSQL_USER: boernetoej
      MYSQL_PASSWORD: boernetoej

    ports:
      - "127.0.0.1:3307:3306"
      # Databasen eksponeres kun lokalt (sikkerhed)
      # 3307 på host → 3306 i containeren

    volumes:
      - mysql_data:/var/lib/mysql
      # Volume bruges til at gemme database-data
      # Data bevares selvom containeren slettes

volumes:
  mysql_data:
  # Docker-managed volume til database-data
